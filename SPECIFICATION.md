# AI 에이전트 스튜디오 기능 명세서

> **버전**: 1.0.0  
> **최종 업데이트**: 2024-12-16  
> **상태**: 프로토타입 완료

---

## 목차

1. [개요 및 목표](#개요-및-목표)
2. [용어 정의](#용어-정의)
3. [권한 관련 정책](#권한-관련-정책)
4. [에이전트 생성 / 설정 / 관리](#에이전트-생성--설정--관리)
5. [상품 구조 및 과금 정책](#상품-구조-및-과금-정책)
6. [보안 및 개인정보 보호 정책](#보안-및-개인정보-보호-정책)
7. [에이전트 동작 제어 및 안전장치](#에이전트-동작-제어-및-안전장치)
8. [권한 및 접근 제어](#권한-및-접근-제어)
9. [모니터링 및 관리](#모니터링-및-관리)
10. [사용자 경험 정책](#사용자-경험-정책)
11. [기술 스택 및 구현 현황](#기술-스택-및-구현-현황)

---

## 개요 및 목표

### 목표
구성원들이 메신저에서 나누는 대화 내용에 대해 자율적으로 행동하는 AI 에이전트를 만드는 것이 목표입니다.

**최종 목표**: AI 에이전트가 한 명의 사람(멤버)처럼 동작하게 만드는 것

### 핵심 가치
- **자율성**: 트리거에 따라 자동으로 행동
- **맥락 이해**: 최근 30개 말풍선을 통한 맥락 파악
- **유연한 행동**: 메시지 답변, 알림 전송, 또는 둘 다 수행 가능
- **통합성**: 외부 시스템(APP, MCP 서버)과의 연동 지원

---

## 용어 정의

| 용어 | 설명 |
|------|------|
| **AI 관리자** | 테넌트의 AI 관련 기능과 콘텐츠를 제어할 수 있는 관리자 |
| **AI 에이전트 관리자** | 생성한 에이전트를 AI 스튜디오에서 관리할 수 있는 구성원. 첫 에이전트 관리자는 해당 에이전트의 생성자이며, 다른 구성원에게 관리 권한을 부여할 수 있음 |
| **AI 에이전트 스튜디오** | AI 에이전트를 생성/조회/수정/이용/삭제할 수 있는 신규 메뉴 |
| **트리거** | 에이전트가 행동을 시작하는 조건 (자연어, 키워드, 명령어) |
| **행동** | 트리거 발생 시 에이전트가 수행하는 동작 (메시지 답변, 알림 전송 등) |
| **외부 연동** | APP 연동 및 MCP 서버 연동을 통합한 개념 |

---

## 권한 관련 정책

### 2.1 AI 에이전트 생성 권한

**대상**: AI 스탠다드/프리미엄 라이선스에 할당된 멤버는 AI 에이전트를 생성할 수 있습니다.

**생성 제한 정책**: 
테넌트 내의 구성원은 구매한 라이선스의 수량만큼 테넌트 내에 에이전트를 생성할 수 있습니다.

```
생성 가능 에이전트 수 = (스탠다드 라이선스 × 1) + (프리미엄 라이선스 × 5)
```

**예시**:
- 스탠다드 라이선스 5개, 프리미엄 라이선스 3개
- 생성 가능 에이전트 수: (5 × 1) + (3 × 5) = **20개**

**생성 권한 관리**:
- 에이전트는 테넌트(조직)에 귀속됨
- AI 에이전트의 생애주기는 AI 관리자가 어드민에서 관리하거나, 에이전트의 관리자가 AI 스튜디오에서 관리
- 에이전트 생성자가 탈퇴하거나 라이선스에서 회수되더라도, 에이전트는 조직에 귀속되어 유지됨

### 2.2 AI 에이전트 메신저 대화방 초대 권한

에이전트 > 메신저 대화방 이용 권한에 따라 초대 가능 여부가 결정됩니다.

- **AI 에이전트 관리자**: 전체
- **전체**: 모든 구성원

### 2.3 AI 에이전트 이용 권한

질의 권한이 있는 구성원은 아래와 같은 이용 흐름에서 질문할 수 있습니다.

**메신저에서의 이용 흐름**:
1. 메신저 대화방에 에이전트를 초대
2. 에이전트는 메신저 대화방에서의 이야기를 듣다가 트리거가 발동하면 해당 이벤트에 대해 자율적으로 답변
3. 메신저 대화방에 있는 구성원들은 해당 에이전트를 호출하여 질문할 수 있음

**AI 대화 메뉴 + 사이드 앱에서의 이용 흐름**:
1. AI 사이드 앱 > 데이터 추가 > 에이전트를 추가
2. 에이전트는 이용자의 질문에 대해 답변
3. 구성원은 에이전트를 호출하여 질문할 수 있음

### 2.4 AI 답변 조회 권한

- 에이전트가 답변한 내용은 해당 대화방의 모든 인원이 볼 수 있음
- 메신저 주제 대화방에 있는 모든 구성원이 에이전트의 답변을 볼 수 있음
- AI 대화 메뉴/사이드앱을 이용하는 구성원이 에이전트의 답변을 볼 수 있음
- 피드백 탭에서 답변 이력 관리: 에이전트 생성자는 모든 답변 이력을 조회할 수 있음

### 2.5 AI 에이전트 답변 방식 제어 권한

AI 에이전트의 답변을 어떤 방식으로 제어할지 선택할 수 있습니다.

**자동 답변**:
- 별도의 승인 없이 대화방의 모든 구성원에게 공유

**구성원 승인 후 답변을 공유하는 경우**:
- 트리거를 발생하게 한 이용자에게만 답변 우선 표시 후 공유 여부 선택하게 함
- 초대한 이용자에게만 답변 우선 표시 후 공유 여부 선택하게 함

**호출에 따른 답변**:
- 별도의 승인 없이 대화방의 모든 구성원에게 공유
- 호출한 이용자에게만 답변 우선 표시 후 공유 여부 선택하게 함

---

## 에이전트 생성 / 설정 / 관리

### 3.1 기본 정보 설정

#### 에이전트 이름
- **입력 제한 규칙**: 멤버 이름 입력 제한 규칙과 동일하게 적용
- **필수 항목**: 예

#### 프로필 이미지
- 커스텀 이미지로 등록 가능
- 선택 항목

#### 에이전트 설명
- **제한**: 50자 내로 간략하게 에이전트를 설명하는 영역
- **필수 항목**: 예

#### 조직 정보
- 테넌트에 생성된 조직 중 선택함
- **필수 항목**: 예

---

### 3.2 데이터 설정

#### 언어 모델 선택
- 테넌트에서 이용 가능한 언어 모델 중 선택 가능
- 기본값: `gemini-2.5-pro`
- **구현 상태**: ✅ 완료

#### 검색 그라운딩 이용 여부
- 외부 검색 활용 옵션
- 체크박스로 활성화/비활성화 가능
- 기본값: 활성화
- **구현 상태**: ✅ 완료

#### 참조 데이터

**구현 방식**: 다이얼로그를 통한 선택 방식

1. **참조 데이터 추가 버튼** 클릭
2. 다이얼로그에서 데이터 타입 선택:
   - **업무**: 업무 관련 콘텐츠 목록 표시
   - **위키**: 위키 콘텐츠 목록 표시
   - **드라이브**: 드라이브 파일 목록 표시
3. 다이얼로그에서 원하는 항목 선택 (다중 선택 가능)
4. 선택한 항목이 데이터 설정 > 참조 데이터 영역에 목록 형태로 등록됨
5. 각 항목별로 활성화/비활성화 토글 가능

**참조 데이터 항목 구조**:
```typescript
{
  id: string
  type: 'tasks' | 'wiki' | 'drive' | 'custom'
  name: string
  enabled: boolean
}
```

**제한 사항**:
- 공유 권한이 있는 콘텐츠만 선택 가능
- **구현 상태**: ✅ 완료

#### 상세 지침
- 에이전트가 참고할 정보나 선호하는 답변 스타일을 자유롭게 작성
- 텍스트 영역으로 입력
- **구현 상태**: ✅ 완료

#### 외부 연동

**통합된 연동 방식**: APP 연동과 MCP 서버 연동을 하나의 "외부 연동" 섹션에서 관리

**연동 추가 방법**:
1. "외부 연동" 섹션에서 "APP 연동 추가" 또는 "MCP 서버 추가" 버튼 클릭
2. 연동 타입에 따라 다른 입력 필드 표시

**APP 연동 설정**:
- 연동 이름
- 서버 URL
- 토큰
- APP ID
- 토큰 범위 (선택)

**MCP 서버 연동 설정**:
- 서버 이름
- 서버 URL
- API Key (선택)
- 연결 테스트 기능

**연동 관리 기능**:
- 연동 목록 표시 (타입, 이름, URL, 상태)
- 각 연동별 활성화/비활성화 토글
- 연동 수정
- 연동 삭제
- 연결 상태 표시 (연결됨/연결 안 됨/오류)

**외부 연동 데이터 구조**:
```typescript
{
  id: string
  type: 'app' | 'mcp'
  name: string
  serverUrl: string
  enabled: boolean
  status?: 'connected' | 'disconnected' | 'error'
  // APP 연동 필드
  token?: string
  appId?: string
  tokenScope?: string[]
  // MCP 서버 필드
  apiKey?: string
  tools?: MCPTool[]
  resources?: MCPResource[]
}
```

**구현 상태**: ✅ 완료

---

### 3.3 트리거 설정

트리거는 에이전트가 행동을 시작하는 조건입니다. 하나의 에이전트에 여러 트리거를 설정할 수 있으며, 각 트리거는 독립적으로 동작합니다.

#### 자연어 트리거
- **설명**: 어떤 내용에 대해 동작하도록 자연어로 설정
- **입력 방식**: 텍스트 입력
- **예시**: "프로젝트 진행 상황에 대해 질문할 때"
- **구현 상태**: ✅ 완료

#### 키워드 트리거
- **설명**: 특정 키워드 탐지 시 발동
- **입력 방식**: 여러 키워드를 쉼표로 구분하여 입력
- **예시**: "일정", "스케줄", "데드라인"
- **트리거 발동 조건**: 키워드가 탐지되면 최근 30개 말풍선을 통해 맥락 파악
- **구현 상태**: ✅ 완료

#### 명령어 트리거
- **설명**: 특정 명령어 키워드로 발동
- **입력 방식**: 
  - 명령어 키워드 (예: `@인사팀 create`)
  - 명령어 설명 (예: "휴가 신청")
- **예시**: `@인사팀 create` → "휴가 신청"
- **구현 상태**: ✅ 완료

#### 트리거 관리
- 트리거 추가: 각 트리거 타입별로 "추가" 버튼 제공
- 트리거 수정: 각 트리거 항목에서 수정 가능
- 트리거 삭제: 각 트리거 항목에서 삭제 가능
- 트리거 목록 표시: 설정된 모든 트리거를 목록 형태로 표시

**트리거 데이터 구조**:
```typescript
{
  id: string
  type: 'natural' | 'keyword' | 'command'
  content: string
  keywords?: string[]  // 키워드 트리거의 경우
  commandKeyword?: string  // 명령어 트리거의 경우
}
```

---

### 3.4 행동 설정

행동 설정은 트리거 설정에서 지정한 트리거에 대해 에이전트가 수행할 행동을 설정하는 메뉴입니다.

**핵심 기능**: 하나의 트리거에 대해 여러 행동을 설정할 수 있습니다.

#### 행동 추가
- 각 트리거별로 "행동 추가" 버튼 제공
- 하나의 트리거에 여러 행동을 추가할 수 있음

#### 행동 유형

각 행동은 다음 중 하나를 선택할 수 있습니다:

1. **메시지 답변만**
   - 에이전트가 대화방에 메시지로 답변
   
2. **알림 전송만**
   - Webhook을 통해 외부 시스템으로 알림 전송
   
3. **메시지 답변 + 알림 전송**
   - 메시지 답변과 알림 전송을 동시에 수행

#### 메시지 답변 설정

**자동 답변 이용**:
- 체크 시: 별도의 승인 없이 대화방의 모든 구성원에게 공유
- 체크 해제 시: 승인 대상 설정 필요

**승인 대상** (자동 답변 비활성화 시):
- 트리거를 발생시킨 이용자
- 에이전트를 초대한 이용자
- 호출한 이용자

#### 알림 스킬 설정

알림 전송을 선택한 경우, 다음 설정이 필요합니다:

**Webhook URL** (필수):
- 알림을 전송할 Webhook URL
- 예: `https://webhook.example.com/notify`

**메시지 템플릿**:
- 알림 메시지 템플릿 작성
- 변수 사용 가능: `{user}`, `{keyword}` 등
- 예: `{user}님이 {keyword} 키워드를 사용했습니다`

**대화 맥락 포함**:
- 체크 시: 최근 30개 말풍선의 맥락을 알림에 포함
- 기본값: 활성화

#### 행동 관리
- 행동 수정: 각 행동 항목에서 수정 가능
- 행동 삭제: 각 행동 항목에서 삭제 버튼 제공
- 행동 목록 표시: 각 트리거별로 설정된 모든 행동을 목록 형태로 표시

**행동 데이터 구조**:
```typescript
{
  id: string
  triggerId: string  // 연결된 트리거 ID
  action: 'message' | 'notification' | 'both'
  autoReply: boolean
  approvalRequired: boolean
  approvalTarget: 'trigger_user' | 'inviter' | 'caller'
  notificationConfig?: {
    webhookUrl: string
    messageTemplate: string
    includeContext: boolean
  }
}
```

**구현 상태**: ✅ 완료

---

### 3.5 활동 이력 조회

#### 활동 영역 조회
- 참여 중인 대화방 확인 가능
- **구현 상태**: ✅ 완료

#### 답변 이력
- 에이전트 생성자가 답변 이력 조회 가능
- 답변 내용, 시간, 대화방 정보 표시
- **구현 상태**: ✅ 완료

#### 트리거 발동 이력
- 언제, 어떤 키워드로 발동되었는지 기록
- 트리거 타입, 키워드, 발동 시간 표시
- **구현 상태**: ✅ 완료

---

### 3.6 권한 설정

#### 에이전트 관리자 권한 설정
- 에이전트 관리자 목록 관리
- 관리자 추가/삭제 가능
- **구현 상태**: ✅ 완료

#### 이용 권한 설정
- **에이전트 관리자만**: 관리자만 이용 가능
- **전체**: 모든 구성원 이용 가능
- **구현 상태**: ✅ 완료

#### 메신저 대화방 이용 권한
- **전체**: 모든 구성원이 대화방에 초대 가능
- **구현 상태**: ✅ 완료

---

## 상품 구조 및 과금 정책

### 대상
AI 스탠다드/프리미엄 라이선스에 할당된 멤버는 AI 에이전트를 생성할 수 있습니다.

### 생성 제한 정책
테넌트 내의 구성원은 구매한 라이선스의 수량만큼 테넌트 내에 에이전트를 생성할 수 있습니다.

```
생성 가능 에이전트 수 = (스탠다드 라이선스 × 1) + (프리미엄 라이선스 × 5)
```

**예시**:
- 스탠다드 라이선스 5개, 프리미엄 라이선스 3개
- 생성 가능 에이전트 수: (5 × 1) + (3 × 5) = **20개**

**구현 상태**: ✅ 완료 (에이전트 목록 화면에 라이선스 정보 표시)

---

## 보안 및 개인정보 보호 정책

### 5.1 데이터 접근 제한

#### 대화방별 격리
- 에이전트는 초대된 대화방의 내용만 접근
- A 대화방의 내용을 B 대화방에서 언급하지 않도록 제한

#### 메모리 관리
- A 대화방의 내용을 B 대화방에서 언급하지 않도록 제한

#### 개인정보 필터링
- 개인정보, 기밀정보 자동 탐지 및 차단은 AI 보안 설정에 따라 동작
- AI 에이전트는 기본적으로 대화방에 초대된 이후부터의 대화를 파악할 수 있음

### 5.2 데이터 보관 및 삭제

#### 임시 컨텍스트
- 트리거 발동 시에만 최근 30개 말풍선 임시 분석

#### 데이터 삭제
- 에이전트 삭제 시 에이전트에 대한 데이터만 삭제
- 에이전트가 답변한 내용은 삭제되지 않음
- 에이전트가 참조하고 있는 데이터의 원본은 삭제되지 않음

---

## 에이전트 동작 제어 및 안전장치

### 6.1 답변 이력 관리
- 답변 이력 메뉴에서 답변한 내용 확인하며 답변 품질 확인 가능
- **구현 상태**: ✅ 완료

### 6.2 오작동 방지 및 제어
- **긴급 정지 기능**: 에이전트 관리자 또는 AI 관리자가 언제든 에이전트 '중지' 가능
- 에이전트 상태: 활성(active) / 일시정지(paused)
- **구현 상태**: ✅ 완료 (에이전트 목록에서 상태 표시)

---

## 권한 및 접근 제어

### 7.1 에이전트 관리 권한

#### 에이전트 관리자 권한
- 에이전트 수정, 삭제, 설정 변경 가능
- **구현 상태**: ✅ 완료

#### AI 관리자 권한
- AI 관리자는 모든 에이전트 관리 가능
- **구현 상태**: ✅ 완료

### 7.2 대화방별 권한 관리

#### 초대 권한
- 이용 권한이 있는 이용자는 모두 초대 가능

#### 제외 권한
- 대화방에 있는 모든 이용자는 에이전트를 대화방에서 제외 가능

---

## 모니터링 및 관리

### 8.1 에이전트 활동 이력 관리

#### 활동 영역 조회
- 참여 중인 대화방 확인 가능
- **구현 상태**: ✅ 완료

#### 답변 이력
- 에이전트 생성자가 답변 이력 조회 가능
- **구현 상태**: ✅ 완료

#### 트리거 발동 이력
- 언제, 어떤 키워드로 발동되었는지 기록
- **구현 상태**: ✅ 완료

### 8.2 사용량 분석 및 리포팅

#### 에너지 사용량
- 일별, 월별 에너지 소모 현황
- **구현 상태**: ⏳ 예정

#### 활용도 분석
- 에이전트별 사용 빈도 및 효과성 분석
- **구현 상태**: ⏳ 예정

---

## 사용자 경험 정책

### 9.1 에이전트 식별 및 표시
- 프로필 표시: 에이전트임을 명확히 구분할 수 있는 UI 제공
- **구현 상태**: ✅ 완료

### 9.2 에이전트 상태 및 답변 수 및 추천 수 표시
- 에이전트가 동작 중인 상태일지 확인 가능
- 이용 또는 중지 상태 표시
- 에이전트 답변 수 표시
- 에이전트 인기도를 표시하는 추천 수 표시
- **구현 상태**: ✅ 완료

---

## 기술 스택 및 구현 현황

### 기술 스택

#### 프론트엔드
- **React 18**: UI 라이브러리
- **TypeScript**: 타입 안정성
- **Vite**: 빌드 도구 및 개발 서버
- **React Router**: 라우팅
- **Lucide React**: 아이콘 라이브러리

#### 스타일링
- CSS Modules 방식
- 반응형 디자인 지원

### 프로젝트 구조

```
src/
├── components/          # 재사용 가능한 컴포넌트
│   ├── Layout.tsx       # 레이아웃 컴포넌트 (헤더, 사이드바)
│   ├── Layout.css
│   ├── AgentForm.tsx    # 에이전트 생성/수정 폼
│   └── AgentForm.css
├── pages/              # 페이지 컴포넌트
│   ├── AgentList.tsx   # 에이전트 목록
│   ├── AgentList.css
│   ├── AgentCreate.tsx # 에이전트 생성
│   ├── AgentCreate.css
│   ├── AgentEdit.tsx   # 에이전트 수정
│   ├── AgentEdit.css
│   ├── AgentActivity.tsx # 활동 이력
│   └── AgentActivity.css
├── types/               # TypeScript 타입 정의
│   └── agent.ts
├── App.tsx             # 라우팅 설정
├── main.tsx            # 진입점
└── index.css           # 전역 스타일
```

### 구현 현황 요약

| 기능 영역 | 구현 상태 | 비고 |
|----------|---------|------|
| 기본 정보 설정 | ✅ 완료 | 이름, 프로필, 설명, 조직 |
| 데이터 설정 - 언어 모델 | ✅ 완료 | |
| 데이터 설정 - 검색 그라운딩 | ✅ 완료 | |
| 데이터 설정 - 참조 데이터 | ✅ 완료 | 다이얼로그 방식 |
| 데이터 설정 - 상세 지침 | ✅ 완료 | |
| 데이터 설정 - 외부 연동 | ✅ 완료 | APP + MCP 통합 |
| 트리거 설정 - 자연어 | ✅ 완료 | |
| 트리거 설정 - 키워드 | ✅ 완료 | |
| 트리거 설정 - 명령어 | ✅ 완료 | |
| 행동 설정 | ✅ 완료 | 다중 행동 지원 |
| 권한 설정 | ✅ 완료 | |
| 활동 이력 조회 | ✅ 완료 | |
| 에이전트 목록 | ✅ 완료 | 테이블 형태 |
| 에이전트 생성/수정 | ✅ 완료 | |
| 라이선스 정보 표시 | ✅ 완료 | |

### 배포 현황

- **GitHub 저장소**: https://github.com/woodykim-khk/DAgent
- **GitHub Pages**: https://woodykim-khk.github.io/DAgent/ (설정 완료)
- **배포 방식**: GitHub Actions를 통한 자동 배포

---

## 향후 개발 사항

### 단기 (1-2개월)
- [ ] 실제 API 연동
- [ ] 메신저 대화방 통합
- [ ] 실시간 활동 모니터링

### 중기 (3-6개월)
- [ ] 에너지 사용량 분석
- [ ] 사용량 리포팅
- [ ] 에이전트 성능 분석 대시보드

### 장기 (6개월 이상)
- [ ] 에이전트 학습 기능
- [ ] 에이전트 간 협업 기능
- [ ] 고급 분석 및 인사이트 제공

---

## 부록

### A. 샘플 데이터

#### 샘플 트리거
1. **키워드 트리거**: "일정", "스케줄", "데드라인"
2. **자연어 트리거**: "프로젝트 진행 상황에 대해 질문할 때"
3. **명령어 트리거**: "@인사팀 create" → "휴가 신청"

#### 샘플 행동
1. **키워드 트리거 (t1)**:
   - 메시지 답변 행동 (자동 답변)
   - 알림 전송 행동 (Webhook URL 포함)
2. **자연어 트리거 (t2)**:
   - 메시지 답변 + 알림 전송 행동

### B. API 명세 (예정)
- 실제 API 연동 시 추가 예정

### C. 에러 코드 (예정)
- 실제 API 연동 시 추가 예정

---

**문서 작성일**: 2024-12-16  
**최종 검토일**: 2024-12-16  
**다음 검토 예정일**: 2025-01-16

